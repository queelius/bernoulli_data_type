\documentclass[ ../main.tex]{subfiles}
\providecommand{\mainx}{..}
\begin{document}
\sections{Random approximate sets with invariants}
Sometimes, a set must satisfy certain invariants.
We have already encountered two invariants in the form of \emph{positive} and \emph{negative} random approximate sets in which if $x \in \Set{A}$ then $x \in \PASet{A}$ and if $x \notin \Set{A}$, then $x \notin \NASet{A}$.
These invariants rely upon the usual partition of the universal set into \emph{positives} and \emph{negatives}, but now we wish to complicate this somewhat.
For instance, if a power set has a member $\{a,b\}$ then it \emph{necessarily} has members $\{a\}$, $\{b\}$, and $\EmptySet$.
In what follows we consider other kinds of invariants.

We restrict our attention to invariants of a set-theoretic quality.
Relational invariants, like \emph{symmetry} or \emph{functional} on \emph{binary relations} are a separate topic. See \cite{approxrel}.

\subsection{Random approximate Cartesian products}
For any Cartesian product $\Set{A} \times \Set{B}$, if $\Pair{a_1}{b_1}$ and $\Pair{a_2}{b_2}$ are positives, then $\Pair{a_1}{b_2}$ must also be a positive.
However, the \emph{random approximate set} of $\Set{A} \times \Set{B}$ may generate a set that violates this invariant.
For example, in the random approximate set $\Pair{a_1}{b_1}$ and $\Pair{a_2}{b_2}$ will be true positives with some probability and $\Pair{a_1}{b_2}$ will be a false negative with some probability.

However, the Cartesian product of random approximate sets is a Cartesian product as given by the following theorem.
\begin{theorem}
	The Cartesian product $\ASet{A}(\tprate_1,\fprate_1) \times \ASet{B}(\tprate_2,\fprate_2)$ is a random approximate set $\ASetType{\left(\Set{A} \times \Set{B}\right)}(\tprate,\fprate)$ that satisfies the constraints of Cartesian products where
	\begin{equation}
	\begin{split}
	\tprate &= ?\,,\\
	\fprate &= ?\,.
	\end{split}
	\end{equation}
\end{theorem}
\begin{proof}
	Prove true positive and false positive rates.
	Then, show how it obeys the constraints of Cartesian products.
\end{proof}

\subsection{Random approximate power sets}
The iterated power set $\PowerSet^{k}$ over the Boolean algebra
$\left(
\PS{\Set{U}},\SetIntersection,\SetUnion,\SetComplement,\EmptySet,\Set{U}
\right)
$
generates the Boolean algebra
$\left(
\PowerSet^k(\Set{U}),\SetIntersection,\SetUnion,\SetComplement,\EmptySet,\PowerSet^{k-1}(\Set{U})
\right)$.

\begin{theorem}
	Given the Boolean algebra $\left(\PS{\Set{U}}\,,\SetIntersection\,,\SetUnion\,,\SetComplement\,,\EmptySet\,,\Set{U}\right)$, $\PowerSet^{k}\!\left(\ASet{A}(\tprate,\fprate)\right)$ is a random approximate power set of $\PowerSet^k(\Set{A})$ with a random true positive rate
	\begin{equation}
		\TPR_{\PS{\ASet{A}}} = 2^{\TP_\p - p}
	\end{equation}
	with an approximate expectation
	\begin{equation}
		\tprate_{\PS{\ASet{A}}} = \frac{\left(2^{\p \tprate}+c\p\tprate(1-\tprate)\right)}{2^\p}
	\end{equation}
	and a random false positive rate
	\begin{equation}
		\FPR_{\PS{\ASet{A}}} = \TPR_{\PS{\ASet{A}}} \frac{2^{\FP_\n} - 1}{2^\n-1}
	\end{equation}
	with an approximate expectation
	\begin{equation}
		\fprate_{\PS{\ASet{A}}} = \tprate_{\PS{\ASet{A}}} \frac{2^{\n \fprate}+c\n\fprate(1-\fprate)-1}{2^\n-1}
	\end{equation}
	where $c = \frac{1}{2} \ln^2 2$.
\end{theorem}
\begin{proof}
	The joint distribution of random true positives and false positives, $\TP_\p$ and $\FP_\n$ respectively, is given by
	\begin{equation}
	\PDF{t_p,f_p}[\TP_\p,\FP_\n]=\binom{\n}{f_p} \binom{\p}{t_p} \fprate^{f_p}(1-\fprate)^{\n-f_p} \tprate^{t_p}(1-\tprate)^{\p-t_p}
	\end{equation}
	
	\emph{False positives} occur in the random approximate power set if the random approximate set we are applying the power set to has any false positives.
	Given $t_p$ true positives and $f_p$ false negatives, the total number of false positives is given by the summation
	\begin{equation}
	\sum_{i=0}^{t_p} \sum_{j=1}^{f_p} \binom{t_p}{i}\binom{f_p}{j}\,,
	\end{equation}
	since we must choose at least one false positive (out of the $f_p$ false positives) and we can pick any number of true positives.
	When we sum over all possibilities, that generates the total number of false positives generated by the power set given $t_p$ true positives and $f_p$ false positives.
	Notice that each combinations is indexed by only of the summations, so we may rewrite this as
	\begin{equation}
	\left(\sum_{i=0}^{t_p} \binom{t_p}{i} \right) \left(\sum_{j=1}^{f_p} \binom{f_p}{j}\right)\,.
	\end{equation}
	The left summation is just $2^{t_p}$ and the right summation is just $2^{f_p}-1$.
	
	So, when there are $t_p$ true positives and $f_p$ false positives in the approximate set, the powerset of the approximation contains $2^{t_p}(2^{f_p}-1)$ false positives, i.e., the powerset has a random number of false positives given by
	\begin{equation}
	\FP_{\PS{\ASet{A}}} = 2^{\TP_\p} \left(2^{\FP_\n} - 1\right)\,.
	\end{equation}
	
	Note that this distribution is no longer binomially distributed. It is a \emph{constrained} random approximate set, since a powerset has a certain structure.
	
	\begin{equation}
	\frac{\Expect{2^{\TP_\p}}\left(2^{\Expect{\FP_\n}}-1\right)}{2^\p(2^\n-1)}\,.
	\end{equation}
\end{proof}
We see that letting $\fprate=0$ yields a random approximate power set with a false positive rate $0$ and letting $\fprate=1$ yields a random approximate power set with, approximately, a false positive rate $2^{-\p(1-\tprate)}$.


With a slight shift in perspective, the \emph{power set} of an approximate set $\ASet{X}$ is equivalently an \emph{approximate subset relation} for $\Set{X}$, i.e.,
\begin{equation}
\Prob{\Set{A} \subseteq \ASet{X} \Given \Set{A} \subseteq \Set{X}} = \fprate\,.
\end{equation}
More generally, instead of random \emph{member-of} unary relations, we may define any random approximate relation.
The \emph{powerset} on random approximate sets is one way of constructing random approximate subset relations, but they may also be constructed \emph{directly}.
The \emph{member-of} predicate may then be defined as
\begin{equation}
\SetContains[a][\ASet{X}] \coloneqq \{a\} \subseteq \ASet{X}\,.
\end{equation}

\subsection{Random approximate disjoint unions}
Suppose we have a family of sets $\{\Set{A}[i] : i \in \Set{I}\}$ indexed by $\Set{I}$. The disjoint union of sets $\Set{A}[i]$ and $\Set{A}[j]$ is given by
\begin{equation}
\Set{A}[i] + \Set{A}[j] =
\SetUnion[\SetBuilder{(x,i)}{x \in \Set{A}[i]}][\SetBuilder{(y,j)}{y \in \Set{A}[j]}]\,.
\end{equation}
The indexes are auxilliary; they are only used to keep track of which set an element in a disjoint union of sets is from. In a computer system, the indexes may come in the form of a \emph{type} such that if you take the disjoint union of sets $\Set{A}$ amd $\Set{B}$ parameterized by types $X$ and $Y$, the result is a set of type $X+Y$ that contains all the elements from $\Set{A}$ and $\Set{B}$.

\begin{theorem}
	Suppose we have a indexed family of sets with $\Set{A}[i]$ indexed by $i$ and $\Set{A}[j]$ indexed by $j$.
	The disjoint union of random approximate sets $\ASet{A}_i(\fnrate_i,\fprate_i)$ and $\ASet{A}_j(\fnrate_j,\fprate_j)$ is a random approximate set with the invariant that it has a false positive rate $\fprate_l$ and a false negative rate $\fnrate_l$ on elements indexed by $l \in \{i,j\}$.
	If the element is not indexed by $i$ or $j$, then the false positive and negative rates are both $0$.
\end{theorem}
\begin{proof}
	Suppose we select an element $x$ assigned index $i$.
	Since an element assigned index $i$ is only a candidate in $\ASet{A}_i$, we only test $x$ for membership in $\ASet{A}_i$.
	If $x$ is a \emph{negative}, it will test as a false positive at a rate of $\fprate_i$ and if $x$ is a \emph{positive}, it will test as a false negative at a rate of $\fnrate_i$.
	The same logic applies to an element $x$ assigned index $j$.
	
	The outcome of a membership test on elements assigned an index $k \notin \{i,j\}$ is given by the following logic.
	Since, by construction, any such element is in the \emph{negative} set, the false negative rate is undefined, i.e., the false negative rate is the ratio of the number of elements that tested negative to the number of elements in the positive set.
	However, we can say that the false negative rate is trivially $0$.
	Similarly, the false positive rate must be $0$ since, by construction, an element indexed by $k$ is only a candidate in some set indexed by $k$, but no such such participates in the disjoint union, and therefore tests negative.
\end{proof}
The \emph{plus} symbol for disjoint union is suggestive. The \emph{cardinality} $\Card{\Set{A}[1]+\Set{A}[2]}$ is the \emph{sum} $\Card{\Set{A}[1]} + \Card{\Set{A}[2]}$, similarly the cardinality of $\Card{\ASet{A}[1](\tprate_1,\fprate_1) + \ASet{A}[2](\tprate_2,\fprate_2)}$ is
\begin{equation}
\fprate_1 u_1 + \fprate_2 u_2 + (\tprate_1 - \fprate_1) \Card{\Set{A}[1]} + (\tprate_2 - \fprate_2) \Card{\Set{A}[2]}\,,
\end{equation}
where $u_1$ and $u_2$ are respectively the cardinalities of the universe of elements with the indexes $1$ and $2$.

\end{document}